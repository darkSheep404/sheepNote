# SheepNote 功能说明

一个基于 IntelliJ IDEA 的笔记插件，帮助开发者在阅读和编写代码时做笔记。

## 功能特点

### 1. 代码笔记
- 支持在代码中选中文本并添加笔记
- 笔记自动关联到对应的代码位置
- 可以快速跳转到笔记关联的代码处
- 笔记编辑功能：
  - 实时编辑：标题和内容支持直接编辑，失焦自动保存
  - 路径编辑：支持通过模态框编辑文件路径
  - 文件跳转：点击路径可直接跳转到对应代码位置
- 笔记列表功能：
  - 支持按名称和时间排序
  - 实时搜索过滤
  - 右键菜单支持删除操作
  - 新笔记自动添加到列表开头并选中

### 2. 流程图功能
- 支持创建和编辑流程图，可视化代码之间的关系
- 流程图节点可以关联到具体的代码笔记
- 节点功能：
  - 显示笔记标题和文件名
  - 支持展示/折叠代码片段
  - 最多支持一个节点连接5个其他节点
  - 右键菜单支持：添加下一个节点、跳转到文件、展开/折叠代码、删除节点
  - 节点状态自动保存
  - 支持拖拽调整位置
  - 双击节点可编辑标题
- 流程图管理：
  - 保存/加载流程图
  - 自动为相关笔记添加流程图名称作为标签
  - 支持展开/折叠所有节点的代码片段
  - 支持自动布局和手动调整
  - 支持缩放和平移画布
- 节点连接：
  - 使用贝塞尔曲线连接节点
  - 自动布局，避免连线重叠
  - 支持拖拽调整连接点
  - 连接线自动避开节点
  - 支持删除连接

### 3. 标签管理
- 支持为笔记添加标签
- 标签自动关联到流程图
- 支持通过标签快速查找相关笔记
- 标签自动去重和格式化
- 支持批量添加和删除标签

### 4. 搜索功能
- 支持按标题和内容搜索笔记
- 实时搜索结果展示
- 可以直接从搜索结果创建流程图节点
- 搜索结果高亮显示匹配内容
- 保持当前选中笔记的状态

## 技术实现

### 前端实现
- 使用原生 JavaScript 和 CSS 构建界面
- 采用 Apple 设计风格：
  - 磨砂玻璃效果（backdrop-filter）
  - 平滑动画过渡
  - 响应式交互
  - 自适应暗色模式
- 编辑功能：
  - contenteditable 实现直接编辑
  - 模态框编辑复杂内容
  - 自动保存机制
- 列表功能：
  - 虚拟滚动优化性能
  - 支持键盘导航
  - 右键菜单支持

### 后端实现
- 基于 IntelliJ Platform Plugin SDK
- 使用 JCEF (Java Chromium Embedded Framework) 实现现代化界面
- 数据存储：
  - SQLite 数据库存储笔记和流程图数据
  - 自动检查和更新数据库结构
  - 事务管理确保数据一致性
- 事件系统：
  - 使用 MessageBus 进行组件间通信
  - 支持实时更新多个视图
  - 异步处理避免阻塞

### 流程图实现
- 使用 jsPlumb 实现节点连接
- 自定义布局算法：
  - 力导向图布局
  - 避免节点重叠
  - 智能连线路由
- 性能优化：
  - 延迟加载
  - 节点状态缓存
  - 按需渲染

## 使用说明

### 创建笔记
1. 在代码中选中要做笔记的文本
2. 使用快捷键或右键菜单创建笔记
3. 输入笔记内容并保存

### 使用流程图
1. 点击工具栏的流程图按钮打开流程图界面
2. 使用"新建节点"按钮创建节点
3. 可以：
   - 搜索已有笔记并添加为节点
   - 直接输入文本创建自定义节点
   - 通过节点右键菜单添加关联节点
4. 使用"保存流程图"按钮保存当前流程图
5. 使用"加载流程图"按钮查看已保存的流程图

## 数据存储
- 笔记数据：
  - 标题、内容、代码位置
  - 创建和更新时间
  - 标签信息
  - 关联的流程图
- 流程图数据：
  - 节点信息和位置
  - 连接关系
  - 样式设置
  - 布局信息
- 所有数据存储在本地 SQLite 数据库中

## 未来计划
### 笔记列表
- [ ] 每个笔记可以绑定多个tag,用,分割 (已实现)
- [ ] 笔记列表增加tags视图,可以查看当前的所有tag,筛选某个tag或者多个tag下的笔记
- [ ] 笔记搜索功能增强,支持按照笔记代码内容和标题搜索
- [ ] 修改当前在IDEA编辑器选中代码做笔记的功能,新建笔记时,可以选择一个或多个tag,默认为上次选择的tag,可以下拉搜索或新建tag
### 流程图
- [ ] 按照IOS的设计风格,美化流程图顶部操作栏
- [ ] 加载流程图时,编辑后再次保存,更新之前的流程图,而非新建一个新的流程图
- [ ] 流程图节点连接线默认为直线,可以调整为曲线
- [ ] 流程图节点支持拖拽调整大小
- [ ] 流程图可以导出为图片
  - [ ] 绘制流程图时,ctrl+s保存流程图
